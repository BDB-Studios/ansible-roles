- name: install nginx
  include: nginx.yml
  when: global_data.packages.nginx is defined

- name: install git
  apt:
    name: git
    state: latest
  become: true

- name: install php
  include: php.yml
  when: global_data.packages.php is defined

- block:
    - name: Create domains
      include: domains.yml
      loop_control:
        loop_var: domain_data
      with_items: "{{ global_data.sites | default([]) }}"

    - name: Reload nginx
      service:
        name: nginx
        state: reloaded
      become: true
      ignore_errors: yes

  when: global_data.sites is defined

